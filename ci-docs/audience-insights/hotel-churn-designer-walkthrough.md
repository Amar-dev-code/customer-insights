
|Sr.No|Step  |Description  |Details  |
|--|--|--|--|
|1|Add Dataset(s)  |Create three datasets <br/>a. **[HotelActivity ](https://cidatasets.blob.core.windows.net/hotel-scenario/ContosoHotel_HotelActivity_1.csv)** <br/>b. **[Customers](https://cidatasets.blob.core.windows.net/hotel-scenario/Customer_1.csv)**<br/>c. **[ServiceUsage](https://cidatasets.blob.core.windows.net/hotel-scenario/ContosoHotel_ServiceUsage_1.csv)** <br/> |![image.png](media/intelligence-designer-walkthrough-step1.png "Step 1")|
|2|Select Columns | Select the following columns for each dataset <br/> a. **HotelActivity** <br/> <ul><li>HotelCustomerID</li><li>CheckInDate</li><li>CheckOutDate</li><li>RoomType</li><li>DollarsSpent</li><li>BookingType</li><li>TravelCategory</li><li>NumberOfNights</li></ul> <br/> b. **Customers** <br/> <ul><li>CustomerId</li><li>ContosoHotel_HotelCustomers_HotelCustomerID</li></ul> <br/> c. **ServiceUsage** <br/> <ul><li>ServicesCustomerID</li><li>ServiceName</li><li>ServiceDate</li><li>ServiceCost</li></ul>  | ![image.png](/.attachments/image-73c7dea6-095e-4e52-aa6f-19f444a4c0a3.png) |
|3|Join Data|Join the data between the HotelActivity and Customers datasets. Use the following columns for the join: <br/> **HotelActivity** - HotelCustomerID <br/> **Customers** - ContosoHotel_HotelCustomers_HotelCustomerID |![image.png](/.attachments/image-8b297615-5bf7-4375-94b1-957e5065b2bf.png) <br/><br/> ![image.png](/.attachments/image-54da8fe3-e76d-4cd5-a8c1-e71d862e9429.png)|
|4|Select Columns|Select the following columns from your results from **Step 3**: <br/> <br/> HotelCustomerID, RoomType, DollarsSpent, BookingType, TravelCategory, CheckInDate, CheckOutDate, NumberOfNights, CustomerId|![image.png](/.attachments/image-86c91791-3b27-4d20-a1c2-943545ee019e.png)|
|5|Apply SQL transformation|Apply the following SQL transformation to filter the data from the Join step <br/><br/> _select * from t1 where [CheckInDate] < "2016-12-31T00:00:00"_|![image.png](/.attachments/image-df15d48c-b679-4014-bb6c-4870833790dd.png)|
|6|Edit Metadata|Change the Data type of the NumberOFNights column to Integer|![image.png](/.attachments/image-b3681283-d442-4ef8-9133-5fe6b2447ad6.png)|
|7|Convert to Indicator Values|Convert the following categorical columns to a series of binary indicator values: <br/> RoomType, BookingType, TravelCategory|![image.png](/.attachments/image-9be536d9-6c00-4d92-a8f9-8a61b27ee2c3.png)|
|8 |Edit Metadata |Change the data types of the following columns to Integer. Additionally, specify that the columns should be treated as **Features**. <br/> RoomType-Large, RoomType-Small, BookingType-Online, BookingType-Phone Call, TravelCategory-Business, TravelCategory-Leisure |![image.png](/.attachments/image-5487eaed-74ea-48b3-b2ee-e5c3b700c87d.png)  |
|9|Apply SQL transformation|Apply the following SQL  transformation: <br/><br/> _select HotelCustomerID, CustomerId, sum([RoomType-Large]) as RoomTypeLargeCount, sum([RoomType-Small]) as RoomTypeSmallCount, sum([BookingType-Online]) as BookingTypeOnlineCount, sum([BookingType-Phone Call]) as BookingTypePhoneCallCount, sum([TravelCategory-Business]) as TravelCategoryBusinessCount, sum([TravelCategory-Leisure]) as TravelCategoryLeisureCount, sum([DollarsSpent]) as TotalDollarSpent from t1 group by HotelCustomerID;_|![image.png](/.attachments/image-2a55d48e-1074-4ea0-b5d6-6183aa5ae5ce.png)|
|10|Edit Metadata | Change the data type of the **NumberOfNights** column from the results of **Step 4** to Integer| ![image.png](/.attachments/image-aeb9d7fd-d470-4d8e-8f30-af75fd413cc1.png)|
|11 | Apply SQL Transformation | Apply the following SQL transformation: <br/><br/> _with StayInfo as (<br/> select HotelCustomerID,<br/> sum(case when [CheckOutDate] <= "2016-12-31T00:00:00" then [NumberOfNights] else 0 end) as StayDayCount,<br/> sum(case when [CheckOutDate] <= "2016-12-31T00:00:00" and [CheckOutDate] >= "2015-01-01T00:00:00" then [NumberOfNights] else 0 end) as StayDayCount2016,<br/> sum(case when [CheckOutDate] <= "2015-12-31T00:00:00" and [CheckOutDate] >= "2014-01-01T00:00:00" then [NumberOfNights] else 0 end) as StayDayCount2015,<br/> sum(case when [CheckOutDate] <= "2014-12-31T00:00:00" and [CheckOutDate] >= "2013-01-01T00:00:00" then [NumberOfNights] else 0 end) as StayDayCount2014,<br/> sum(case when [CheckOutDate] <= "2016-12-31T00:00:00" then 1 else 0 end) as StayCount,<br/> sum(case when [CheckOutDate] <= "2016-12-31T00:00:00" and [CheckOutDate] >= "2015-01-01T00:00:00" then 1 else 0 end) as StayCount2016,<br/> sum(case when [CheckOutDate] <= "2015-12-31T00:00:00" and [CheckOutDate] >= "2014-01-01T00:00:00" then 1 else 0 end) as StayCount2015,<br/> sum(case when [CheckOutDate] <= "2014-12-31T00:00:00" and [CheckOutDate] >= "2013-01-01T00:00:00" then 1 else 0 end) as StayCount2014,<br/> min([CheckInDate]) as FirstStay,<br/> max([CheckOutDate]) as LastStay<br/> from t1 <br/> group by HotelCustomerID)_ <br/><br/> _select HotelCustomerID, StayDayCount, StayDayCount2016, StayDayCount2015, StayDayCount2014, StayCount, StayCount2016, StayCount2015, StayCount2014, julianday("2016-12-31T00:00:00") - julianday(FirstStay) as UsageTenure, case when LastStay > "2016-12-31T00:00:00" then 0 else 1 end as Label from StayInfo_; |![image.png](/.attachments/image-5adf3ad5-497f-4d47-ace0-dab2f1dda4bd.png)|
|12 |Join Data | Join the data between the results from **Steps 9 and 11.** Use the following columns for the join: <br/> **Left** - HotelCustomerID <br/> **Right** - HotelCustomerID | ![image.png](/.attachments/image-5e49a444-78a0-4435-9b81-936c11ad7fef.png) |
|13 | Apply SQL Transformation | Apply the following SQL transformation to the results from selecting columns from the ServiceUsage dataset in **Step 2**: <br/><br/> _select ServicesCustomerID, <br/> sum(case when ServiceName='concierge' then ServiceCost else 0 end) as ConciergeUsage, <br/> sum(case when ServiceName='courier' then ServiceCost else 0 end) as CourierUsage, <br/> sum(case when ServiceName='dry_cleaning' then ServiceCost else 0 end) as DryCleaningUsage, <br/> sum(case when ServiceName='gym' then ServiceCost else 0 end) as GymUsage, <br/> sum(case when ServiceName='phone' then ServiceCost else 0 end) as PhoneUsage, <br/> sum(case when ServiceName='restaurant' then ServiceCost else 0 end) as RestaurantUsage, <br/> sum(case when ServiceName='spa' then ServiceCost else 0 end) as SpaUsage, <br/> sum(case when ServiceName='television' then ServiceCost else 0 end) as TelevisionUsage, <br/> sum(case when ServiceName='wifi' then ServiceCost else 0 end) as WifiUsage <br/> from t1 where ServiceDate < "2016-12-31T00:00:00" <br/> group by ServicesCustomerID;_ | ![image.png](/.attachments/image-3e97c79f-4558-40b2-8bd3-1fa76b9ea944.png) |
|14 | Join Data | Join the data between the results from **Steps 12 and 13.** Use the following columns for the join: <br/> **Left** - HotelCustomerID <br/> **Right** - ServicesCustomerID| ![image.png](/.attachments/image-6c894bed-45b4-4d7a-a705-8f54d224e6dc.png) |
|15 | Edit Metadata | Mark the following columns as ClearFeatures: <br/><br/> HotelCustomerID, CustomerId | ![image.png](/.attachments/image-63499bd1-705b-4efc-9eca-af02cd457fa7.png) |
|16 | Edit Metadata | Select the **Label** column to be used as as Label | ![image.png](/.attachments/image-ac3b9ea9-9e22-4b05-8ddd-298bbfff76b2.png) |
|17 | Clean Missing Data | Handle any missing values by specifying the settings from the screenshot | ![image.png](/.attachments/image-1520bf53-a172-4112-8913-e5d89be77714.png) |
|18 | Split Data | Split the results of the cleaned data into 2: 70% for training your model and 30% for testing the trained model | ![image.png](/.attachments/image-4966a419-c233-4b18-ab10-2434cb34ae6b.png) | 
|19 | Train Model | Add the **Train Model** module and connect the left hand side results of the **Split Data** module (Step 18) to the right hand side of the **Train Model** module. <br/><br/> Specify the column that column that contains the Label or Outcome column. It is the **Label** column in our case. | ![image.png](/.attachments/image-7a0f9547-7520-4a4a-b229-fd1947ffb1d9.png) |
|20 | Two-Class Boosted Decision Tree | Use the Two-Class Boosted Decision Tree to train your model. Connect the Two-Class Boosted Decision Tree module to the left hand side of the Train Model module (Step 19). Specify the settings shown in the screenshot. | ![image.png](/.attachments/image-29ab0531-ce62-462e-b752-4db410fbf7cd.png) |
|21 | Score Model | Make predictions using the trained model on your test data. Connect the trained model from the **Train Model** module (Step 19) to the left hand side of the **Score Model** module. Connect the right hand side results of the **Split Data** module (Step 18) to the right hand side of the **Score Model** module. <br/><br/> Check the **Append score columns to output** checkbox so that the columns in your final output will contain all the columns in addition to the Label columns | ![image.png](/.attachments/image-beddcc44-7cd4-45d3-93eb-a1acb4e0fe40.png) |
|22 | Evaluate Model | Evaluate the results of your trained model with standard metrics. | ![image.png](/.attachments/image-6340a93e-c034-48a2-8148-14eb01009953.png) |
|23 | Submit the pipeline | Click on the **Submit** button to set up your pipeline run. Enter the required details such as **Experiment Name**, and **Run Description**. <br/> Create and select a Compute target for the run if you don't already have one. <br/><br/> Submit the run| ![image.png](/.attachments/image-abbf5690-5e5d-48d8-98a7-56d46bfaec95.png) |
|24 | Create Batch Inference Pipeline | Once the training pipeline has completed successfully, click _Create inference pipeline -> Batch inference pipeline_ to create a batch inference pipeline from your training pipeline.   | ![image.png](/.attachments/image-551d433b-78b9-4932-9a62-072e80a45c34.png) |
|25 | Dataset Parameterization | In this step, we'll parameterize the 3 datasets so that we can pass in new data from Customer Insights for making predictions. <br/><br/> Select the **HotelActivity** dataset node, and check the _Set as pipeline parameter_ checkbox in the **Parameters** tab of the right side pane. Enter a **Parameter name**, for example, **HotelActivity**, to represent the selected dataset. Repeat for the **Customers** and **ServiceUsage** datasets. | ![image.png](/.attachments/image-6d6c30d8-06cc-4cd9-a365-5c51af6a9dd7.png) |
|26 | Export Data | Add the **Export Data** module to your Batch inference pipeline. This module allows us to get our predicted results into Customer Insights. Connect the bottom of the **Score Model** module to the **Export Data** module. <br/><br/> Click on the Export Data module to open the side pane. Make the following changes: <br/><br/> <ul><li>**Datastore type**: Select _Azure Blob Storage_</li><li>**Datastore**: Select _workspaceblobstore_</li><li>**Path**: Enter a name for your predictions output. E.g. _HotelChurnPredictions_</li><li>**File format**: Select _csv_</li></ul> | ![image.png](/.attachments/image-3e2570f9-3bb1-4569-acce-0c021e4ceffb.png) |
|27 | Export Data Parameterization | In this step, we'll parameterize our Export Data module so that our predictions can be imported and used within Customer Insights. <br/><br/> Click on the Export Data module to open the side pane and then click on the ellipses on top of the datastore dropdown. <br/>Click on Add to pipeline parameter. Enter a name in the **Parameter Name** textbox that you can easily identify in Customer Insights. Click Save. <br/><br/><br/><br/><br/><br/> Repeat for the Path field.| ![image.png](/.attachments/image-5c907b35-132e-4be1-b701-847f383e2b42.png) <br/> <br/> ![image.png](/.attachments/image-891480c8-cc40-4fda-aa40-35bff9359054.png) <br/><br/> ![image.png](/.attachments/image-39560ed7-0dc7-4ae8-8238-a1b9816aa262.png)|
|28 | Submit and Publish Pipeline Endpoint | **Submit** the batch inference pipeline. <br/> Once it has completed successfully, click on **Publish** to open the published pipeline dialog. <br/> Select **Create new** and enter a name for your endpoint. Enter a name that you can easily identify later on. <br/> Click on **Publish** to publish your batch inference pipeline endpoint. It is now discoverable in Customer Insights! | ![image.png](/.attachments/image-e0a0f49e-97da-4e34-9666-077bad8c4185.png) |

